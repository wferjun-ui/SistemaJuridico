<UserControl x:Class="SistemaJuridico.Views.ProcessoListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SistemaJuridico.ViewModels">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <Style x:Key="UniformButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="3"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Background" Value="#4F46E5"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4F46E5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="NeutralButtonStyle" TargetType="Button" BasedOn="{StaticResource UniformButtonStyle}">
            <Setter Property="Background" Value="#64748B"/>
            <Setter Property="BorderBrush" Value="#64748B"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,8" Background="#FFF8FAFC">
            <StackPanel>
                <DockPanel LastChildFill="True" Margin="0,0,0,6">
                    <TextBlock DockPanel.Dock="Left" Text="Pesquisar e selecionar processo" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <WrapPanel DockPanel.Dock="Right" HorizontalAlignment="Right">
                        <Button Style="{StaticResource UniformButtonStyle}" Content="Novo Processo" Command="{Binding NovoProcessoCommand}"/>
                        <Button Style="{StaticResource UniformButtonStyle}" Content="Atualizar" Command="{Binding CarregarCommand}"/>
                        <Button Style="{StaticResource UniformButtonStyle}" Content="Busca avançada" Command="{Binding ToggleBuscaAvancadaCommand}"/>
                        <Button Style="{StaticResource UniformButtonStyle}" Content="Exportar" Command="{Binding ExportarResultadosCommand}"/>
                    </WrapPanel>
                </DockPanel>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" MinWidth="280" Margin="0,0,8,0" Text="{Binding TextoBusca, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Grid.Column="1" Style="{StaticResource UniformButtonStyle}" Content="Buscar" Width="120" Command="{Binding BuscarCommand}"/>
                    <Button Grid.Column="2" Style="{StaticResource NeutralButtonStyle}" Content="Limpar" Width="120" Command="{Binding LimparFiltrosCommand}"/>
                </Grid>

                <Border Margin="0,6,0,0"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        CornerRadius="6"
                        Background="White"
                        Visibility="{Binding MostrarSugestoesBusca, Converter={StaticResource BoolToVis}}">
                    <ListBox ItemsSource="{Binding SugestoesBusca}" MaxHeight="220" BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:ProcessoBuscaItemVM}">
                                <Button Style="{StaticResource UniformButtonStyle}"
                                        HorizontalContentAlignment="Left"
                                        Height="Auto"
                                        MinWidth="0"
                                        Margin="0"
                                        Background="Transparent"
                                        Foreground="#111827"
                                        BorderBrush="Transparent"
                                        Padding="8,6"
                                        Command="{Binding DataContext.SelecionarSugestaoBuscaCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Paciente}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Numero}" FontSize="12" Opacity="0.85"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

                <Border Margin="0,8,0,0"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        CornerRadius="6"
                        Background="White"
                        Visibility="{Binding MostrarResultadosBuscaRapida, Converter={StaticResource BoolToVis}}">
                    <StackPanel>
                        <TextBlock Text="Resultados da pesquisa"
                                   FontWeight="SemiBold"
                                   Background="#F8FAFC"
                                   Padding="10,8"
                                   BorderBrush="#E5E7EB"
                                   BorderThickness="0,0,0,1"/>
                        <ListBox ItemsSource="{Binding ResultadosBuscaRapida}" MaxHeight="260" BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:ProcessoBuscaItemVM}">
                                    <Button Style="{StaticResource UniformButtonStyle}"
                                            HorizontalContentAlignment="Left"
                                            Height="Auto"
                                            MinWidth="0"
                                            Margin="0"
                                            Background="Transparent"
                                            Foreground="#111827"
                                            BorderBrush="Transparent"
                                            Padding="10,8"
                                            Command="{Binding DataContext.AbrirResultadoBuscaRapidaCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Paciente}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Numero}" FontSize="12" Opacity="0.85"/>
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <Border Grid.Row="1" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,8"
                Visibility="{Binding MostrarBuscaAvancada, Converter={StaticResource BoolToVis}}">
            <StackPanel>
                <WrapPanel>
                    <StackPanel Width="190" Margin="0,0,10,6">
                        <TextBlock Text="Status"/>
                        <TextBox Text="{Binding StatusFiltro, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Width="190" Margin="0,0,10,6">
                        <TextBlock Text="Tipo"/>
                        <TextBox Text="{Binding TipoFiltro, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Width="190" Margin="0,0,10,6">
                        <TextBlock Text="Responsável"/>
                        <TextBox Text="{Binding ResponsavelFiltro, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Width="140" Margin="0,0,10,6">
                        <TextBlock Text="Saldo mín."/>
                        <TextBox Text="{Binding ValorMinimo, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Width="140" Margin="0,0,10,6">
                        <TextBlock Text="Saldo máx."/>
                        <TextBox Text="{Binding ValorMaximo, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <StackPanel Width="220" Margin="0,0,10,6">
                        <TextBlock Text="Palavra-chave"/>
                        <TextBox Text="{Binding PalavraChaveHistorico, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </WrapPanel>
                <TextBlock Text="{Binding ResumoEstatistico}" FontStyle="Italic" Opacity="0.8"/>
            </StackPanel>
        </Border>

        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Processos}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectedItem="{Binding ProcessoSelecionado}"
                  MouseDoubleClick="DataGrid_MouseDoubleClick">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Número" Binding="{Binding Numero}" Width="150"/>
                <DataGridTextColumn Header="Paciente" Binding="{Binding Paciente}" Width="2*"/>
                <DataGridTextColumn Header="Genitor" Binding="{Binding Genitor}" Width="*"/>
                <DataGridTextColumn Header="Juiz" Binding="{Binding Juiz}" Width="*"/>
                <DataGridTextColumn Header="Tipo" Binding="{Binding TipoProcesso}" Width="*"/>
                <DataGridTextColumn Header="Status" Binding="{Binding StatusCalculado}" Width="*"/>
                <DataGridTextColumn Header="Saldo" Binding="{Binding Saldo, StringFormat=R$ {0:N2}}" Width="140"/>
                <DataGridTemplateColumn Header="Ação" Width="110">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Style="{StaticResource UniformButtonStyle}"
                                    Content="Abrir"
                                    MinWidth="80"
                                    Height="30"
                                    Command="{Binding DataContext.AbrirProcessoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <DockPanel Grid.Row="3" Margin="0,8,0,0">
            <TextBlock DockPanel.Dock="Left"
                       VerticalAlignment="Center"
                       Text="{Binding ResumoEstatistico}"
                       Opacity="0.85"/>

            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Style="{StaticResource UniformButtonStyle}" Content="◀" Width="44" Command="{Binding PaginaAnteriorCommand}"/>
                <TextBlock VerticalAlignment="Center" Margin="6,0" Text="{Binding PaginaAtual, StringFormat=Página {0}}"/>
                <TextBlock VerticalAlignment="Center" Margin="2,0" Text="de"/>
                <TextBlock VerticalAlignment="Center" Margin="2,0,8,0" Text="{Binding TotalPaginas}"/>
                <Button Style="{StaticResource UniformButtonStyle}" Content="▶" Width="44" Command="{Binding ProximaPaginaCommand}"/>
            </StackPanel>
        </DockPanel>
    </Grid>
</UserControl>
