<Window x:Class="SistemaJuridico.Views.ProcessoDetalhesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:SistemaJuridico.Views"
        x:Name="RootWindow"
        Title="Detalhes do Processo"
        Height="720"
        Width="1260"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="#F3F4F6">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="14"/>
        </Style>

        <Style x:Key="TabItemStyle" TargetType="TabItem">
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Foreground" Value="#4F46E5"/>
                    <Setter Property="BorderBrush" Value="#4F46E5"/>
                    <Setter Property="BorderThickness" Value="0,0,0,2"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Padding" Value="12,7"/>
            <Setter Property="Background" Value="#4F46E5"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4F46E5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>

        <Style x:Key="MutedButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#E5E7EB"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#B91C1C"/>
            <Setter Property="BorderBrush" Value="#B91C1C"/>
        </Style>
    </Window.Resources>

    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="#FEF3C7"
                BorderBrush="#FCD34D"
                BorderThickness="1"
                CornerRadius="8"
                Padding="10"
                Margin="0,0,0,10"
                Visibility="{Binding ModoSomenteLeitura, Converter={StaticResource BoolToVis}}">
            <TextBlock Text="{Binding UsuarioEditandoTexto}" FontWeight="SemiBold" Foreground="#92400E"/>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="14"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Resumo do Processo" FontSize="19" FontWeight="Bold" Margin="0,0,0,14"/>

                    <TextBlock Text="Paciente" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Processo.Paciente}" Margin="0,0,0,8"/>

                    <TextBlock Text="Representante" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Processo.Representante}" Margin="0,0,0,8"/>

                    <TextBlock Text="Número" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Processo.Numero}" Margin="0,0,0,8"/>

                    <TextBlock Text="Juiz" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Processo.Juiz}" Margin="0,0,0,8"/>

                    <TextBlock Text="Status" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Processo.StatusFase}" Margin="0,0,0,8"/>

                    <Separator Margin="0,8"/>

                    <TextBlock Text="Saldo a prestar" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TotalContasAPrestar, StringFormat=R$ {0:N2}}" Margin="0,0,0,8"/>

                    <TextBlock Text="Última verificação" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding UltimaVerificacaoData}" Margin="0,0,0,8"/>

                    <TextBlock Text="Último responsável" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding UltimaVerificacaoResponsavel}" Margin="0,0,0,8"/>

                    <TextBlock Text="Hash" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding HashProcesso}" Margin="0,0,0,8"/>

                    <TextBlock Text="Data da prescrição" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding DataPrescricao}" Margin="0,0,0,8"/>

                    <TextBlock Text="Status da atualização" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding PrescricaoStatus}" Foreground="#B45309"/>
                </StackPanel>
            </Border>

            <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                <TabControl BorderThickness="0" Background="Transparent" ItemContainerStyle="{StaticResource TabItemStyle}">
                    <TabItem Header="Verificação Geral">
                        <ScrollViewer Margin="4" VerticalScrollBarVisibility="Auto" PreviewMouseWheel="VerificacaoScrollViewer_PreviewMouseWheel">
                            <StackPanel>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                        <TextBlock Text="Status do Processo" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                        <ComboBox MinHeight="34"
                                                  ItemsSource="{Binding StatusProcessoOpcoes}"
                                                  SelectedItem="{Binding StatusVerificacao, UpdateSourceTrigger=PropertyChanged}"
                                                  IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                        <TextBlock Text="Responsável" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                        <TextBox MinHeight="34" Text="{Binding ResponsavelVerificacao, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Margin="0,0,0,8">
                                    <TextBlock Text="O que foi feito?" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                    <TextBox MinHeight="74" AcceptsReturn="True" TextWrapping="Wrap" Text="{Binding DescricaoVerificacao, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                </StackPanel>

                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                        <TextBlock Text="Diligências" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                        <ComboBox MinHeight="34"
                                                  ItemsSource="{Binding DiligenciaOpcoes}"
                                                  SelectedItem="{Binding DescricaoDiligencia, UpdateSourceTrigger=PropertyChanged}"
                                                  IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                        <TextBlock Text="Prazo da diligência" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                        <TextBox MinHeight="34" Text="{Binding PrazoDiligencia, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Diligências pendentes" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                    <TextBox MinHeight="64" AcceptsReturn="True" TextWrapping="Wrap" Text="{Binding DescricaoPendencias, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding PodeAcessarAbaVerificacao}"/>
                                </StackPanel>

                                <Border BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" Padding="10" Background="#F9FAFB" Margin="0,0,0,10">
                                    <StackPanel>
                                        <TextBlock Text="Verificação de Itens de Saúde" FontWeight="SemiBold" FontSize="15" Margin="0,0,0,8"/>

                                        <ItemsControl ItemsSource="{Binding ItensSaude}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,0,0,8" Background="White">
                                                        <StackPanel>
                                                            <TextBlock FontWeight="SemiBold" Foreground="#1F2937">
                                                                <Run Text="{Binding Nome}"/>
                                                                <Run Text=" ("/>
                                                                <Run Text="{Binding Tipo}"/>
                                                                <Run Text=")"/>
                                                            </TextBlock>

                                                            <UniformGrid Columns="2" Margin="0,6,0,0">
                                                                <StackPanel Margin="0,0,8,0">
                                                                    <TextBlock Text="Quantidade prescrita" FontSize="12"/>
                                                                    <TextBox MinHeight="32" Text="{Binding Qtd, UpdateSourceTrigger=PropertyChanged}"/>
                                                                </StackPanel>
                                                                <StackPanel Margin="8,0,0,0">
                                                                    <TextBlock Text="Local de tratamento" FontSize="12"/>
                                                                    <TextBox MinHeight="32" Text="{Binding Local, UpdateSourceTrigger=PropertyChanged}"/>
                                                                </StackPanel>
                                                            </UniformGrid>

                                                            <WrapPanel Margin="0,8,0,0">
                                                                <CheckBox Content="Tratamento desnecessário" IsChecked="{Binding IsDesnecessario}" Margin="0,0,14,4"/>
                                                                <CheckBox Content="Modificação na quantidade" IsChecked="{Binding IsQuantidadeModificada}" Margin="0,0,14,4"/>
                                                                <CheckBox Content="Modificação no local" IsChecked="{Binding IsLocalTratamentoModificado}" Margin="0,0,14,4"/>
                                                                <CheckBox Content="SUS" IsChecked="{Binding IsSus}" Margin="0,0,14,4"/>
                                                                <CheckBox Content="Particular" IsChecked="{Binding IsParticular}" Margin="0,0,14,4"/>
                                                            </WrapPanel>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="Salvar Verificação" MinWidth="170" Padding="14,7" Command="{Binding NovaVerificacaoCommand}" Style="{StaticResource PrimaryButton}"/>
                                    <Button Content="Desfazer Última Verificação" MinWidth="220" Padding="14,7" Command="{Binding DesfazerUltimaVerificacaoCommand}" IsEnabled="{Binding PodeDesfazerUltimaVerificacao}" Style="{StaticResource MutedButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <TabItem Header="Prestação de Contas">
                        <views:ContasView ProcessoId="{Binding Processo.Id}" />
                    </TabItem>

                    <TabItem Header="Histórico">
                        <ScrollViewer Margin="6" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding Verificacoes}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,0,0,8" Padding="10" BorderThickness="1" BorderBrush="#E5E7EB" Background="#F9FAFB" CornerRadius="6">
                                            <StackPanel>
                                                <TextBlock FontWeight="Bold" Foreground="#1F2937">
                                                    <Run Text="Data: "/>
                                                    <Run Text="{Binding DataHora}"/>
                                                    <Run Text="  •  Status: "/>
                                                    <Run Text="{Binding StatusProcesso}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,4,0,0">
                                                    <Run Text="Responsável: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding Responsavel}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,2,0,0" TextWrapping="Wrap">
                                                    <Run Text="Diligência: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding DiligenciaDescricao}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,2,0,0" TextWrapping="Wrap">
                                                    <Run Text="Pendências: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding PendenciaDescricao}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,2,0,0" TextWrapping="Wrap">
                                                    <Run Text="Prazo da diligência: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding PrazoDiligencia}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,6,0,0" TextWrapping="Wrap" Foreground="#374151">
                                                    <Run Text="Alterações (como estava / o que mudou): " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding AlteracoesTexto}"/>
                                                </TextBlock>
                                                <TextBlock Margin="0,6,0,0" TextWrapping="Wrap" Foreground="#4B5563">
                                                    <Run Text="Registro de diligência: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding DiligenciaRealizada}"/>
                                                    <Run Text=" | Possui pendências: " FontWeight="SemiBold"/>
                                                    <Run Text="{Binding DiligenciaPendente}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <WrapPanel Grid.Row="2" HorizontalAlignment="Right" Margin="0,10,0,0" ItemHeight="36">
            <Button Content="Salvar rascunho" MinWidth="140" Command="{Binding SalvarRascunhoCommand}" Style="{StaticResource MutedButton}"/>
            <Button Content="Concluir edição" MinWidth="140" Command="{Binding ConcluirEdicaoCommand}" Style="{StaticResource MutedButton}"/>
            <Button Content="Editar processo" MinWidth="140" Command="{Binding AbrirEdicaoProcessoCommand}" Style="{StaticResource PrimaryButton}"/>
            <Button Content="Excluir processo" MinWidth="140" Command="{Binding AbrirConfirmacaoExclusaoCommand}" Style="{StaticResource DangerButton}"/>
            <Button Content="Fechar" MinWidth="110" Background="#2563EB" BorderBrush="#2563EB" Foreground="White" Margin="4,0" Padding="12,7" Click="Fechar_Click"/>
        </WrapPanel>

        <Border Grid.RowSpan="3"
                Background="#99000000"
                Visibility="{Binding IsEditDialogOpen, Converter={StaticResource BoolToVis}}">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="560">
                <Border Style="{StaticResource CardStyle}" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Editar Processo" FontSize="18" FontWeight="Bold" Margin="0,0,0,12"/>

                        <TextBlock Text="Número"/>
                        <TextBox Text="{Binding NumeroEdicao, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,8"/>

                        <TextBlock Text="Paciente"/>
                        <TextBox Text="{Binding PacienteEdicao, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,8"/>

                        <TextBlock Text="Representante"/>
                        <TextBox Text="{Binding RepresentanteEdicao, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,8"/>

                        <TextBlock Text="Juiz"/>
                        <TextBox Text="{Binding JuizEdicao, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,8"/>

                        <TextBlock Text="Status"/>
                        <TextBox Text="{Binding StatusFaseEdicao, UpdateSourceTrigger=PropertyChanged}" Margin="0,2,0,12"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Cancelar" Width="110" Style="{StaticResource MutedButton}" Command="{Binding CancelarEdicaoProcessoCommand}"/>
                            <Button Content="Salvar" Width="110" Style="{StaticResource PrimaryButton}" Command="{Binding ConfirmarEdicaoProcessoCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <Border Grid.RowSpan="3"
                Background="#99000000"
                Visibility="{Binding IsDeleteDialogOpen, Converter={StaticResource BoolToVis}}">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="500">
                <Border Style="{StaticResource CardStyle}" Padding="18">
                    <StackPanel>
                        <TextBlock Text="Excluir processo" FontSize="18" FontWeight="Bold" Margin="0,0,0,8"/>
                        <TextBlock TextWrapping="Wrap" Text="Deseja excluir permanentemente este processo e todos os dados vinculados? Esta ação não pode ser desfeita." Margin="0,0,0,14"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Cancelar" Width="110" Style="{StaticResource MutedButton}" Command="{Binding CancelarExclusaoCommand}"/>
                            <Button Content="Excluir" Width="110" Style="{StaticResource DangerButton}" Command="{Binding ExcluirProcessoCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
