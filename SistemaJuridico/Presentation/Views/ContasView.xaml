<UserControl x:Class="SistemaJuridico.Views.ContasView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SistemaJuridico.ViewModels">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <Style x:Key="EntradaCellStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#15803D"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style x:Key="SaidaCellStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#B91C1C"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,8"
                Visibility="{Binding ExibirFormularioContas, Converter={StaticResource BoolToVis}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.3*"/>
                    <ColumnDefinition Width="1.1*"/>
                    <ColumnDefinition Width="1.1*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,6">
                    <TextBlock Text="Tipo de Registro *" FontWeight="SemiBold"/>
                    <ComboBox SelectedValuePath="Content"
                              SelectedValue="{Binding TipoLancamentoSelecionado, UpdateSourceTrigger=PropertyChanged}">
                        <ComboBoxItem Content="Alvará"/>
                        <ComboBoxItem Content="Tratamento"/>
                        <ComboBoxItem Content="Despesa Geral"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,8,6">
                    <TextBlock Text="Data da movimentação *" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.DataMovimentacao, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2" Margin="8,0,0,6">
                    <TextBlock Text="Responsável" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.Responsavel, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,6" Visibility="{Binding IsCampoMovimentoVisivel, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Mov. processo (número)" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.MovProcesso, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding IsAlvara}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,6" Visibility="{Binding IsMovimentoOpcional, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Mov. processo" FontWeight="SemiBold"/>
                    <ComboBox SelectedValue="{Binding ModoMovimentoConta, UpdateSourceTrigger=PropertyChanged}" SelectedValuePath="Content"
                              IsEnabled="{Binding IsValorContaHabilitado}">
                        <ComboBoxItem Content="Anexo"/>
                        <ComboBoxItem Content="Digitar"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,8,6" Visibility="{Binding ExibirCampoMovimentoDigitado, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Nº movimento digitado" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding MovimentoContaDigitado, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="2" Margin="8,0,0,6" Visibility="{Binding IsCampoNfAlvaraVisivel, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Nº NF / Alvará" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.NumNfAlvara, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,6">
                    <TextBlock Text="Histórico / Detalhes *" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.Historico, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,8,6">
                    <TextBlock Text="Valor do Alvará" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ValorAlvaraTexto, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding IsAlvara}" TextChanged="ValorAlvara_TextChanged"/>
                </StackPanel>

                <StackPanel Grid.Row="3" Grid.Column="1" Margin="8,0,8,6">
                    <TextBlock Text="Valor da Conta" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ValorContaTexto, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding IsValorContaHabilitado}" TextChanged="ValorConta_TextChanged"/>
                </StackPanel>

                <StackPanel Grid.Row="3" Grid.Column="2" Margin="8,0,0,6" Visibility="{Binding IsTratamento, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Terapia / Medicamento" FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding TerapiasMedicamentosDisponiveis}" SelectedItem="{Binding EdicaoConta.TerapiaMedicamentoNome, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding IsTratamento}"/>
                </StackPanel>

                <StackPanel Grid.Row="4" Grid.Column="0" Margin="0,0,8,6" Visibility="{Binding ExibirCampoTerapiaManual, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Outro (informar)" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding TerapiaManual, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <StackPanel Grid.Row="4" Grid.Column="1" Margin="8,0,8,6" Visibility="{Binding ExibirCamposReferencia, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Quantidade" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.Quantidade, UpdateSourceTrigger=PropertyChanged}" MaxLength="12"/>
                </StackPanel>

                <Grid Grid.Row="4" Grid.Column="2" Margin="8,0,0,6" Visibility="{Binding ExibirCamposReferencia, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="Mês referência" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding EdicaoConta.MesReferencia, UpdateSourceTrigger=PropertyChanged}" MaxLength="2"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Ano referência" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding EdicaoConta.AnoReferencia, UpdateSourceTrigger=PropertyChanged}" MaxLength="4"/>
                    </StackPanel>
                </Grid>

                <StackPanel Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,4">
                    <TextBlock Text="Observações" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding EdicaoConta.Observacoes, UpdateSourceTrigger=PropertyChanged}" Height="56" AcceptsReturn="True" TextWrapping="Wrap"/>
                </StackPanel>
            </Grid>
        </Border>

        <WrapPanel Grid.Row="1" HorizontalAlignment="Right" Margin="0,0,0,8" ItemHeight="38"
                   Visibility="{Binding ExibirFormularioContas, Converter={StaticResource BoolToVis}}">
            <Button Content="Adicionar ao rascunho" Command="{Binding AdicionarRascunhoCommand}" IsEnabled="{Binding PodeCadastrar}" Margin="4" MinWidth="165" Padding="12,7"/>
            <Button Content="Confirmar rascunhos" Command="{Binding ConfirmarRascunhosCommand}" IsEnabled="{Binding PodeCadastrar}" Margin="4" MinWidth="160" Padding="12,7"/>
            <Button Content="Limpar rascunhos" Command="{Binding LimparRascunhosCommand}" IsEnabled="{Binding PodeCadastrar}" Margin="4" MinWidth="145" Padding="12,7"/>
            <Button Content="Salvar edição" Command="{Binding SalvarEdicaoContaCommand}" IsEnabled="{Binding PodeEditar}" Margin="4" MinWidth="130" Padding="12,7"/>
            <Button Content="Editar selecionada" Command="{Binding EditarContaCommand}" IsEnabled="{Binding PodeEditar}" Margin="4" MinWidth="145" Padding="12,7"/>
            <Button Content="Excluir selecionada" Command="{Binding ExcluirContaCommand}" IsEnabled="{Binding PodeExcluir}" Margin="4" MinWidth="150" Padding="12,7"/>
            <Button Content="Exportar PDF" Command="{Binding ExportarPrestacaoContasPdfCommand}" Margin="4" MinWidth="120" Padding="12,7"/>
        </WrapPanel>

        <GroupBox Header="Rascunhos de contas" Grid.Row="2" Margin="0,0,0,8"
                  Visibility="{Binding ExibirFormularioContas, Converter={StaticResource BoolToVis}}">
            <DataGrid ItemsSource="{Binding ContasRascunho}" AutoGenerateColumns="False" IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Data" Binding="{Binding DataMovimentacao}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Tipo" Binding="{Binding TipoLancamento}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Mov. Proc." Binding="{Binding MovProcesso}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Histórico" Binding="{Binding Historico}" Width="*"/>
                    <DataGridTextColumn Header="Entrada" Binding="{Binding ValorAlvara, StringFormat=R$ {0:N2}}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Saída" Binding="{Binding ValorConta, StringFormat=R$ {0:N2}}" Width="SizeToHeader"/>
                    <DataGridTemplateColumn Header="Ações" Width="SizeToCells">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Remover" Command="{Binding DataContext.RemoverRascunhoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <GroupBox Header="Prestação de contas (saldo progressivo)" Grid.Row="3">
            <DataGrid ItemsSource="{Binding HistoricoContas}" SelectedItem="{Binding ContaSelecionada}" AutoGenerateColumns="False" IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Data" Binding="{Binding Conta.DataMovimentacao}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Tipo" Binding="{Binding Conta.TipoLancamento}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Mov. Processo" Binding="{Binding Conta.MovProcesso}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Nº NF/Alvará" Binding="{Binding Conta.NumNfAlvara}" Width="SizeToHeader"/>
                    <DataGridTextColumn Header="Histórico/Detalhes" Binding="{Binding Conta.Historico}" Width="*"/>
                    <DataGridTextColumn Header="Crédito" Binding="{Binding Conta.ValorAlvara, StringFormat=R$ {0:N2}}" Width="SizeToHeader" ElementStyle="{StaticResource EntradaCellStyle}"/>
                    <DataGridTextColumn Header="Débito" Binding="{Binding Conta.ValorConta, StringFormat=R$ {0:N2}}" Width="SizeToHeader" ElementStyle="{StaticResource SaidaCellStyle}"/>
                    <DataGridTextColumn Header="Saldo parcial" Binding="{Binding SaldoParcial, StringFormat=R$ {0:N2}}" Width="SizeToHeader"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>
    </Grid>
</UserControl>
